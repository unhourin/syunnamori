<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tomato.syunnamori.Dao.CreatureRealTimeDao">
<select id="queryRealTime" resultType="Creature">
select
			c.c_code,c.t_code,c.c_name,c.c_price,c.s_conditions,c.img,c.c_place,c.f_sh,c.sh_name,
			m.c_code "month.c_code",
			m.earth "month.earth",
			m.start_month "month.start_month",
			m.end_month "month.end_month",
			m.start_time "month.start_time",
			m.end_time "month.end_time"
		from
			creature as c
		inner join
			month as m
		on
			c.c_code = m.c_code
		where
			(
				(m.start_month <![CDATA[ <= ]]> m.end_month )
				AND
				(m.START_TIME <![CDATA[ <= ]]> m.END_TIME)
				AND
				(m.start_month <![CDATA[ <= ]]> MONTH(NOW()))
				AND
				(MONTH(NOW()) <![CDATA[ <= ]]>  m.end_month)
				AND
				(m.START_TIME <![CDATA[ <= ]]> HOUR(NOW()))
				AND
				(HOUR(NOW()) <![CDATA[ <= ]]> m.END_TIME)
			)
			OR
			(
				(m.start_month <![CDATA[ => ]]> m.end_month)
				AND
				(m.START_TIME <![CDATA[ <= ]]> m.END_TIME)
				AND
					(
						(start_month  <![CDATA[ <= ]]>  MONTH(NOW()))
					OR
						(MONTH(NOW()) <![CDATA[ <= ]]> m.end_month)
					)
				AND
				(m.START_TIME <![CDATA[ <= ]]> HOUR(NOW()))
				AND
				(HOUR(NOW()) <![CDATA[ <= ]]> m.END_TIME)
			)
			OR
			(
				(m.start_month <![CDATA[ <= ]]>  m.end_month)
				AND
				(m.START_TIME <![CDATA[ => ]]> m.END_TIME)
				AND
				(m.start_month <![CDATA[ <= ]]> MONTH(NOW()))
				AND
				(MONTH(NOW()) <![CDATA[ <= ]]>  m.end_month)
				AND
				(
					(m.START_TIME <![CDATA[ <= ]]> HOUR(NOW()))
				OR
					(HOUR(NOW()) <![CDATA[ <= ]]> m.END_TIME)
				)
			)
			OR
			(
				(m.start_month <![CDATA[ => ]]>  m.end_month)
				AND
				(m.START_TIME <![CDATA[ => ]]> m.END_TIME)
				AND
				(
					(m.START_TIME <![CDATA[ <= ]]> HOUR(NOW()))
				OR
					(HOUR(NOW()) <![CDATA[ <= ]]> m.END_TIME)
				)
				AND
				(
					(start_month  <![CDATA[ <= ]]>  MONTH(NOW()))
				OR
					(MONTH(NOW()) <![CDATA[ <= ]]> m.end_month)
				)
			);
	</select>
</mapper>